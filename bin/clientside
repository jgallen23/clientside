#!/usr/bin/env node

var program = require('commander');
var Library = require('../lib/library');
var packageReader = require('../lib/package-reader');
var fs = require('fs');
var path = require('path');

program
  .version('0.0.1')
  .option('-e, --export <name>', 'Module Name')
  .usage('-e <name> [file]');

program.on('--help', function() {
  console.log('  Examples:');  
  console.log('Pass in params');  
  console.log('    $ clientside --export module index.js > dist/module.js');
  console.log('Read from package.json');  
  console.log('    $ clientside > dist/module.js');
}); 

program.parse(process.argv);


var files = program.args;

if (program.export && files.length == 1) {
  var file = files[0];
  file = path.join(process.cwd(), file);
  var l = new Library(program.export, file);
  var out = l.build();
  process.stdout.write(out);
} else {
  //read from package.json
  if (path.existsSync('package.json')) {
    var json = JSON.parse(fs.readFileSync('package.json'));
    var l = packageReader(json);
    var out = l.build();
    process.stdout.write(out);
  } else {
    process.stdout.write(program.helpInformation());
    program.emit('--help');
    process.exit(1);
  }
}

